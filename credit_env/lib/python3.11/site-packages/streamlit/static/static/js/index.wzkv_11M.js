import{r as c,E as j,_ as Y,bm as C,bn as _,v as g,e as D,j as n,P as G,b as q,B as J,ao as T,T as ut,F as Q,u as W,an as gt,ai as ht,bo as ft,h as mt,a6 as yt,as as Ct,bp as bt,m as H,bh as vt,bi as It}from"./index.CD8HuT3N.js";import{g as wt,C as xt,I as St,F as $,E as Z,a as Ft,s as Ut,u as Dt,b as Et}from"./FileHelper.M6AAaeuA.js";import{I as zt}from"./InputInstructions.z6sVgyYt.js";import{u as Tt,T as Bt}from"./useTextInputAutoExpand.4iAdLWD-.js";import{i as Rt}from"./inputUtils.CptNuJwn.js";import{E as Lt}from"./ErrorOutline.esm.DcGrhbBP.js";import{U as tt}from"./UploadFileInfo.C-jY39rj.js";import"./base-input.CK3UVGp1.js";var et=c.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(j,Y({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),c.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),c.createElement("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 015 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 005 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"}))});et.displayName="AttachFile";var ot=c.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(j,Y({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),c.createElement("rect",{width:24,height:24,fill:"none"}),c.createElement("path",{d:"M3 5.51v3.71c0 .46.31.86.76.97L11 12l-7.24 1.81c-.45.11-.76.51-.76.97v3.71c0 .72.73 1.2 1.39.92l15.42-6.49c.82-.34.82-1.5 0-1.84L4.39 4.58C3.73 4.31 3 4.79 3 5.51z"}))});ot.displayName="Send";const nt=(t,e)=>e===C.Directory?{...t,webkitdirectory:"",multiple:!0}:t,Ht=(t,e)=>{if(!e||e.length===0)return!0;const o=t.name.toLowerCase(),i=o.lastIndexOf(".");if(i===-1||i===o.length-1)return e.some(m=>m===""||m===".");const p=o.substring(i),s=o.substring(i+1);return e.some(m=>{const b=m.toLowerCase();return b.startsWith(".")?p===b:s===b})},Vt=(t,e)=>Ht(t,e)?{isValid:!0}:{isValid:!1,errorMessage:`${t.type||"This type of"} files are not allowed.`},rt=t=>{switch(t){case C.None:return"a file";case C.Single:return"a file";case C.Multiple:return"files";case C.Directory:return"a directory";default:return _(t),"a file"}},Mt=g("div",{target:"e15560op0"})(({theme:t,height:e})=>({backgroundColor:t.colors.transparent,position:"absolute",left:0,bottom:0,minHeight:`max(${t.sizes.emptyDropdownHeight}, ${e})`,width:"100%",zIndex:t.zIndices.priority})),$t=g("div",{target:"e15560op1"})(({theme:t,height:e})=>({border:`${t.sizes.borderWidth} solid`,borderColor:t.colors.primary,borderRadius:t.radii.chatInput,backgroundColor:t.colors.secondaryBg,color:t.colors.primary,display:"flex",alignItems:"center",justifyContent:"center",height:e,width:"100%",fontWeight:t.fontWeights.bold})),Wt=g("div",{target:"e15560op2"})(({theme:t,disabled:e})=>({display:"flex",alignItems:"top",height:"100%",marginTop:`-${t.sizes.borderWidth}`,cursor:e?"not-allowed":"auto"})),kt=g("div",{target:"e15560op3"})(({disabled:t})=>({pointerEvents:t?"none":"auto"})),Nt=g("div",{target:"e15560op4"})(({theme:t})=>({marginTop:"0.625em",marginLeft:t.spacing.sm,height:t.spacing.xl,width:t.sizes.borderWidth,backgroundColor:t.colors.fadedText20})),At=g("div",{target:"e15560op5"})(({theme:t})=>({left:0,right:0,lineHeight:t.lineHeights.tight,paddingLeft:t.spacing.sm,paddingRight:t.spacing.sm,overflowX:"auto"})),Pt=g("div",{target:"e15560op6"})({display:"flex"}),Kt=g("div",{target:"e15560op7"})({flex:"0 0 auto"}),Ot=g("div",{target:"e15560op8"})(({theme:t})=>({display:"flex",alignItems:"center",padding:t.spacing.sm,gap:t.spacing.twoXS})),Xt=g("div",{target:"e15560op9"})(({theme:t})=>({color:t.colors.fadedText60})),jt=g("div",{target:"e15560op10"})(({theme:t,fileStatus:e})=>({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:e.type==="uploaded"?t.colors.bodyText:t.colors.fadedText60})),Yt=g("div",{target:"e15560op11"})(({theme:t})=>({marginRight:t.spacing.md,color:t.colors.fadedText60})),_t=g("small",{target:"e15560op12"})(({theme:t})=>({display:"flex",alignItems:"center",maxHeight:t.sizes.smallElementHeight,color:t.colors.fadedText60,"& :hover":{color:t.colors.bodyText}})),Gt=({getRootProps:t,getInputProps:e,acceptFile:o,disabled:i,theme:p})=>{const s=nt(e(),o);return D(Wt,{disabled:i,children:[D(kt,{"data-testid":"stChatInputFileUploadButton",disabled:i,...t(),children:[n("input",{...s}),n(ut,{content:`Upload or drag and drop ${rt(o)}`,placement:G.TOP,onMouseEnterDelay:500,children:n(q,{kind:J.MINIMAL,disabled:i,children:n(T,{content:et,size:"lg",color:i?p.colors.fadedText40:p.colors.fadedText60})})})]}),n(Nt,{})]})},qt=c.memo(Gt),Jt=({getRootProps:t,getInputProps:e,acceptFile:o,inputHeight:i})=>{const p=nt(e(),o);return D(Q,{children:[n(Mt,{height:i,...t(),children:n("input",{...p})}),n($t,{height:i,children:`Drag and drop ${rt(o)} here`})]})},Qt=c.memo(Jt);function Zt({children:t,content:e}){const o=W();return n(gt,{content:e,placement:G.TOP,overrides:{Body:{style:{top:`-${o.sizes.minElementHeight}`}}},children:t})}const te=({fileInfo:t})=>{const e=W(),{type:o}=t.status;switch(o){case"uploading":return n(ht,{"data-testid":"stChatInputFileIconSpinner",size:"lg",margin:"0",padding:"0"});case"error":return n(Zt,{content:t.status.errorMessage,children:n(T,{color:e.colors.red,content:Lt,size:"lg"})});case"uploaded":return n(T,{content:St,size:"lg"});default:return _(o),null}},ee=({fileInfo:t,onDelete:e})=>D(Ot,{className:"stChatInputFile","data-testid":"stChatInputFile",children:[n(Xt,{children:n(te,{fileInfo:t})}),n(jt,{className:"stChatInputFileName","data-testid":"stChatInputFileName",title:t.name,fileStatus:t.status,children:t.name}),n(Yt,{children:wt(t.size,$.Byte)}),n(_t,{"data-testid":"stChatInputDeleteBtn",children:n(q,{onClick:()=>e(t.id),kind:J.MINIMAL,children:n(T,{content:xt,size:"lg"})})})]}),oe=c.memo(ee),ne=({items:t,onDelete:e})=>n(At,{"data-testid":"stChatUploadedFiles",children:n(Pt,{children:t.map(o=>n(Kt,{children:n(oe,{fileInfo:o,onDelete:e})},o.id))})}),re=c.memo(ne),ae=(t,e)=>{const o=[],i=[];return t.forEach(p=>{const s=Vt(p,e.fileType);s.isValid?o.push(p):i.push({file:p,errors:[{code:Z.FileInvalidType,message:s.errorMessage||"File type not allowed."}]})}),{accepted:o,rejected:i}},ie=({acceptMultipleFiles:t,acceptDirectoryFiles:e,maxFileSize:o,uploadClient:i,uploadFile:p,addFiles:s,getNextLocalFileId:m,deleteExistingFiles:b,onUploadComplete:w,element:v})=>(f,h)=>{if(e&&f.length>0){const{accepted:u,rejected:y}=ae(f,v);f=u,h=[...h,...y]}if(!t&&f.length===0&&h.length>1){const u=h.findIndex(y=>y.errors?.[0].code===Z.TooManyFiles);u>=0&&(f.push(h[u].file),h.splice(u,1))}if(!t&&f.length>0&&b(),i.fetchFileURLs(f).then(u=>{ft(u,f).forEach(([y,x])=>{p(y,x)})}).catch(u=>{s(f.map(y=>new tt(y.name,y.size,m(),{type:"error",errorMessage:u})))}),h.length>0){const u=h.map(y=>Ft(y,m(),o));s(u)}w()},se=({getNextLocalFileId:t,addFiles:e,updateFile:o,uploadClient:i,element:p,onUploadProgress:s,onUploadComplete:m})=>(b,w)=>{const v=w.webkitRelativePath||w.name,f=new AbortController,h=new tt(v,w.size,t(),{type:"uploading",abortController:f,progress:1});e([h]),i.uploadFile({formId:"",...p},b.uploadUrl,w,u=>s(u,h.id),f.signal).then(()=>m(h.id,b)).catch(u=>{u instanceof DOMException&&u.name==="AbortError"||o(h.id,h.setStatus({type:"error",errorMessage:u?u.toString():"Unknown error"}))})},le=g("div",{target:"e1togvvn0"})("border:none;position:relative;display:flex;"),de=g("div",{target:"e1togvvn1"})(({theme:t,extended:e})=>({border:`${t.sizes.borderWidth} solid`,borderColor:t.colors.widgetBorderColor??t.colors.transparent,borderRadius:t.radii.chatInput,backgroundColor:t.colors.secondaryBg,position:"relative",flexGrow:1,display:"flex",alignItems:"center",paddingLeft:t.spacing.lg,maxHeight:e?"none":t.sizes.minElementHeight,gap:t.spacing.sm,overflow:"hidden",":focus-within":{borderColor:t.colors.primary}})),ce=g("button",{target:"e1togvvn2"})(({theme:t,disabled:e,extended:o})=>{const i=mt(t),[p,s]=i?[t.colors.gray60,t.colors.gray80]:[t.colors.gray80,t.colors.gray40];return{border:"none",backgroundColor:t.colors.transparent,borderTopRightRadius:o?"0":t.radii.chatInput,borderTopLeftRadius:o?t.radii.default:"0",borderBottomRightRadius:t.radii.chatInput,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:t.lineHeights.none,margin:t.spacing.none,padding:t.spacing.sm,color:e?p:s,pointerEvents:"auto","&:focus":{outline:"none"},":focus":{outline:"none"},"&:focus-visible":{backgroundColor:i?t.colors.gray10:t.colors.gray90},"&:hover":{color:t.colors.primary},"&:disabled, &:disabled:hover, &:disabled:active":{backgroundColor:t.colors.transparent,borderColor:t.colors.transparent,color:t.colors.gray,cursor:"not-allowed"}}}),pe=g("div",{target:"e1togvvn3"})(({theme:t})=>({display:"flex",alignItems:"flex-end",height:"100%",position:"absolute",right:0,marginBottom:`-${t.sizes.borderWidth}`,pointerEvents:"none"})),ue=g("div",{target:"e1togvvn4"})(({theme:t})=>({position:"absolute",bottom:"0px",right:`calc(${t.iconSizes.xl} + 2 * ${t.spacing.sm} + ${t.spacing.sm})`})),V=(t,e,o)=>o.map(i=>i.id===t?e:i),M=(t,e)=>e.find(o=>o.id===t);function ge({disabled:t,element:e,widgetMgr:o,fragmentId:i,uploadClient:p}){const s=W(),{placeholder:m,maxChars:b}=e,w=c.useRef(0),v=c.useRef(null),{width:f,elementRef:h}=yt(),{innerWidth:u,innerHeight:y}=Ct(),[x,B]=c.useState(e.default),[F,U]=c.useState([]),[E,R]=c.useState(!1),S=Tt({textareaRef:v,dependencies:[m]}),L=c.useMemo(()=>F.some(r=>r.status.type==="uploading")?!1:x!==""||F.length>0,[F,x]),I=bt(e.acceptFile),k=Ut(e.maxUploadSizeMb,$.Megabyte,$.Byte),N=c.useCallback(r=>U(l=>[...l,...r]),[]),A=c.useCallback(r=>{U(l=>{const d=M(r,l);return H(d)?l:(d.status.type==="uploading"&&d.status.abortController.abort(),d.status.type==="uploaded"&&d.status.fileUrls.deleteUrl&&p.deleteFile(d.status.fileUrls.deleteUrl),l.filter(a=>a.id!==r))})},[p]),at=()=>{const r=F.filter(l=>l.status.type==="uploaded").map(l=>{const{name:d,size:a,status:z}=l,{fileId:ct,fileUrls:pt}=z;return new vt({fileId:ct,fileUrls:pt,name:d,size:a})});return new It({uploadedFileInfo:r})},P=()=>w.current++,it=ie({acceptMultipleFiles:I===C.Multiple||I===C.Directory,acceptDirectoryFiles:I===C.Directory,maxFileSize:k,uploadClient:p,uploadFile:se({getNextLocalFileId:P,addFiles:N,updateFile:(r,l)=>{U(d=>V(r,l,d))},uploadClient:p,element:e,onUploadProgress:(r,l)=>{U(d=>{const a=M(l,d);if(H(a)||a.status.type!=="uploading")return d;const z=Math.round(r.loaded*100/r.total);return a.status.progress===z?d:V(l,a.setStatus({type:"uploading",abortController:a.status.abortController,progress:z}),d)})},onUploadComplete:(r,l)=>{U(d=>{const a=M(r,d);return H(a)||a.status.type!=="uploading"?d:V(a.id,a.setStatus({type:"uploaded",fileId:l.fileId,fileUrls:l}),d)})}}),addFiles:N,getNextLocalFileId:P,deleteExistingFiles:()=>F.forEach(r=>A(r.id)),onUploadComplete:()=>{v.current&&v.current.focus()},element:e}),{getRootProps:K,getInputProps:O}=Dt({onDrop:it,multiple:I===C.Multiple||I===C.Directory,accept:Et(e.fileType),maxSize:k}),X=()=>{if(v.current&&v.current.focus(),!L||t)return;const r={data:x,fileUploaderState:at()};o.setChatInputValue(e,r,{fromUi:!0},i),U([]),B(""),S.clearScrollHeight()},st=r=>{const{metaKey:l,ctrlKey:d,shiftKey:a}=r;Rt(r)&&!a&&!d&&!l&&(r.preventDefault(),X())},lt=r=>{const{value:l}=r.target;b!==0&&l.length>b||(B(l),S.updateScrollHeight())};c.useEffect(()=>{if(e.setValue){e.setValue=!1;const r=e.value||"";B(r)}},[e]),c.useEffect(()=>{const r=a=>{a.preventDefault(),a.stopPropagation(),!E&&a.dataTransfer?.types.includes("Files")&&R(!0)},l=a=>{a.preventDefault(),a.stopPropagation(),E&&(a.clientX<=0&&a.clientY<=0||a.clientX>=u&&a.clientY>=y)&&R(!1)},d=a=>{a.preventDefault(),a.stopPropagation(),E&&R(!1)};return window.addEventListener("dragover",r),window.addEventListener("drop",d),window.addEventListener("dragleave",l),()=>{window.removeEventListener("dragover",r),window.removeEventListener("drop",d),window.removeEventListener("dragleave",l)}},[E,u,y]);const dt=I!==C.None&&E;return D(Q,{children:[I===C.None?null:n(re,{items:[...F],onDelete:A}),n(le,{className:"stChatInput","data-testid":"stChatInput",ref:h,children:dt?n(Qt,{getRootProps:K,getInputProps:O,acceptFile:I,inputHeight:S.height}):D(de,{extended:S.isExtended,children:[I===C.None?null:n(qt,{getRootProps:K,getInputProps:O,acceptFile:I,disabled:t,theme:s}),n(Bt,{inputRef:v,value:x,placeholder:m,onChange:lt,onKeyDown:st,"aria-label":m,disabled:t,rows:1,overrides:{Root:{style:{minHeight:s.sizes.minElementHeight,outline:"none",borderLeftWidth:"0",borderRightWidth:"0",borderTopWidth:"0",borderBottomWidth:"0",borderTopLeftRadius:"0",borderTopRightRadius:"0",borderBottomRightRadius:"0",borderBottomLeftRadius:"0"}},Input:{props:{"data-testid":"stChatInputTextArea"},style:{fontWeight:s.fontWeights.normal,lineHeight:s.lineHeights.inputWidget,"::placeholder":{color:s.colors.fadedText60},height:S.height,maxHeight:S.maxHeight,paddingLeft:s.spacing.none,paddingBottom:s.spacing.sm,paddingTop:s.spacing.sm,paddingRight:`calc(${s.iconSizes.xl} + 2 * ${s.spacing.sm} + ${s.spacing.sm})`}}}}),f>s.breakpoints.hideWidgetDetails&&n(ue,{children:n(zt,{dirty:L,value:x,maxLength:b,type:"chat",inForm:!1})}),n(pe,{children:n(ce,{onClick:X,disabled:!L||t,extended:S.isExtended,"data-testid":"stChatInputSubmitButton",children:n(T,{content:ot,size:"xl",color:"inherit"})})})]})})]})}const we=c.memo(ge);export{we as default};
