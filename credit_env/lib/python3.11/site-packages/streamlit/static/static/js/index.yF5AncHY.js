import{r as c,E as x,_ as U,v as p,aA as X,e as g,j as a,ao as m,b as y,c as O,B as w,at as j,F as _,bg as G,aR as K,bo as Y,m as f,aa as F,bh as J,bi as Q,l as Z,R as ee,T as te,P as ie,W as se}from"./index.CD8HuT3N.js";import{F as oe}from"./FormClearHelper.DHh1GFzm.js";import{g as I,F as S,b as le,D as ne,I as ae,C as re,a as de,s as ce}from"./FileHelper.M6AAaeuA.js";import{S as pe,P as ge}from"./ProgressBar.BEY0cXXV.js";import{u as ue}from"./Hooks.DGu1od_L.js";import{U as v}from"./UploadFileInfo.C-jY39rj.js";var C=c.forwardRef(function(e,s){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(x,U({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:s}),c.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),c.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"}))});C.displayName="ChevronLeft";var b=c.forwardRef(function(e,s){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(x,U({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:s}),c.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),c.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6-6-6z"}))});b.displayName="ChevronRight";var M=c.forwardRef(function(e,s){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(x,U({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:s}),c.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),c.createElement("path",{d:"M19.35 10.04A7.49 7.49 0 0012 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 000 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95A5.469 5.469 0 0112 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5 1.53.11A2.98 2.98 0 0122 15c0 1.65-1.35 3-3 3zM8 13h2.55v3h2.9v-3H16l-4-4z"}))});M.displayName="CloudUpload";var B=c.forwardRef(function(e,s){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(x,U({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:s}),c.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}))});B.displayName="Error";const D=p("section",{target:"e1d2qte90"})(({isDisabled:e,theme:s})=>({display:"flex",gap:s.spacing.lg,alignItems:"center",padding:s.spacing.lg,backgroundColor:s.colors.secondaryBg,borderRadius:s.radii.default,border:s.colors.widgetBorderColor?`${s.sizes.borderWidth} solid ${s.colors.widgetBorderColor}`:void 0,height:s.sizes.largestElementHeight,":focus":{outline:"none"},":focus-visible":{boxShadow:`0 0 0 1px ${s.colors.primary}`},cursor:e?"not-allowed":"pointer"})),he=p("div",{target:"e1d2qte91"})(({theme:e})=>({marginRight:"auto",alignItems:"center",display:"flex",gap:e.spacing.lg,minWidth:0,width:"100%"})),V=p("span",{target:"e1d2qte92"})(({theme:e})=>({color:e.colors.darkenedBgMix100})),L=p("span",{target:"e1d2qte93"})(({theme:e,disabled:s})=>({color:s?e.colors.fadedText40:e.colors.bodyText})),fe=p("span",{target:"e1d2qte94"})(({theme:e,disabled:s})=>({fontSize:e.fontSizes.sm,color:s?e.colors.fadedText40:e.colors.fadedText60,display:"block",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",maxWidth:"100%"})),me=p("div",{target:"e1d2qte95"})({display:"flex",flexDirection:"column",minWidth:0,maxWidth:"100%"}),Fe=p("span",{target:"e1d2qte96"})({whiteSpace:"nowrap"}),E=p("div",{target:"e1d2qte97"})(({theme:e})=>({left:0,right:0,lineHeight:e.lineHeights.tight,paddingTop:e.spacing.md,paddingLeft:e.spacing.lg,paddingRight:e.spacing.lg})),ye=p("ul",{target:"e1d2qte98"})(({theme:e})=>({listStyleType:"none",margin:e.spacing.none,padding:e.spacing.none})),P=p("li",{target:"e1d2qte99"})(({theme:e})=>({margin:e.spacing.none,padding:e.spacing.none})),A=p("div",{target:"e1d2qte910"})(({theme:e})=>({display:"flex",alignItems:"baseline",flex:1,paddingLeft:e.spacing.lg,overflow:"hidden"})),T=p("div",{target:"e1d2qte911"})(({theme:e,disabled:s})=>({marginRight:e.spacing.sm,marginBottom:e.spacing.twoXS,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:s?e.colors.fadedText40:e.colors.bodyText})),W=p("div",{target:"e1d2qte912"})(({theme:e})=>({display:"flex",alignItems:"center",marginBottom:e.spacing.twoXS})),we=p("span",{target:"e1d2qte913"})(({theme:e})=>({marginRight:e.spacing.twoXS})),Se=p("div",{target:"e1d2qte914"})(({theme:e,disabled:s})=>({display:"flex",padding:e.spacing.twoXS,color:s?e.colors.fadedText40:e.colors.darkenedBgMix100})),N=p("small",{target:"e1d2qte915"})(({theme:e})=>({color:e.colors.red,fontSize:e.fontSizes.sm,height:e.fontSizes.sm,lineHeight:e.fontSizes.sm,display:"flex",alignItems:"center",whiteSpace:"nowrap"})),R=p("span",{target:"e1d2qte916"})({}),xe=e=>({[D]:{display:"flex",flexDirection:"column",alignItems:"flex-start",height:"auto",gap:e.spacing.sm},[V]:{display:"none"},[L]:{marginBottom:e.spacing.twoXS},[E]:{paddingRight:e.spacing.lg},[W]:{maxWidth:"inherit",flex:1,alignItems:"flex-start",marginBottom:e.spacing.sm},[T]:{width:e.sizes.full},[A]:{flexDirection:"column"},[N]:{height:"auto",whiteSpace:"initial"},[R]:{display:"none"},[P]:{margin:e.spacing.none,padding:e.spacing.none}}),Ue=p("div",{target:"e1d2qte917"})(({theme:e,width:s})=>{if(s<X("23rem"))return xe(e)}),ve=({multiple:e,acceptedExtensions:s,maxSizeBytes:t,acceptDirectory:i=!1,disabled:o})=>{const l=()=>i?"directories":e?"files":"file",n=()=>s.length?` â€¢ ${s.map(d=>d.replace(/^\./,"").toUpperCase()).join(", ")}`:null,r=()=>`Limit ${I(t,S.Byte,0)} per file`;return g(he,{"data-testid":"stFileUploaderDropzoneInstructions",children:[a(V,{children:a(m,{content:M,size:"threeXL"})}),g(me,{children:[g(L,{disabled:o,children:["Drag and drop ",l()," here"]}),g(fe,{disabled:o,children:[r(),n()]})]})]})},ze=c.memo(ve),Ie=({onDrop:e,multiple:s,acceptedExtensions:t,maxSizeBytes:i,disabled:o,label:l,acceptDirectory:n=!1})=>a(ne,{onDrop:e,multiple:s,accept:le(t),maxSize:i,disabled:o,useFsAccessApi:!1,children:({getRootProps:r,getInputProps:d})=>{const u=d({multiple:s||!!n});return g(D,{...r(),"data-testid":"stFileUploaderDropzone",isDisabled:o,"aria-label":l,"aria-disabled":o,children:[a("input",{"data-testid":"stFileUploaderDropzoneInput",...u,...n&&{webkitdirectory:""}}),a(ze,{multiple:s,acceptedExtensions:t,maxSizeBytes:i,acceptDirectory:n,disabled:o}),a(Fe,{children:a(y,{kind:w.SECONDARY,disabled:o,size:O.SMALL,children:n?"Browse directories":"Browse files"})})]})}}),Ce=c.memo(Ie),q=p("small",{target:"e1w49r0d0"})(({kind:e,disabled:s,theme:t})=>{const{danger:i,fadedText60:o,fadedText40:l}=t.colors;let n=o;return s&&(n=l),e==="danger"&&(n=i),{color:n,fontSize:t.fontSizes.sm,lineHeight:t.lineHeights.tight}}),be=({fileInfo:e,disabled:s})=>e.status.type==="uploading"?a(ge,{value:e.status.progress,size:pe.SMALL}):e.status.type==="error"?g(N,{children:[a(we,{"data-testid":"stFileUploaderFileErrorMessage",children:e.status.errorMessage}),a(R,{children:a(m,{content:B,size:"lg"})})]}):e.status.type==="uploaded"?a(q,{disabled:s,children:I(e.size,S.Byte)}):null,Me=({fileInfo:e,onDelete:s,disabled:t})=>g(W,{className:"stFileUploaderFile","data-testid":"stFileUploaderFile",children:[a(Se,{disabled:t,children:a(m,{content:ae,size:"twoXL"})}),g(A,{className:"stFileUploaderFileData",children:[a(T,{className:"stFileUploaderFileName","data-testid":"stFileUploaderFileName",title:e.name,disabled:t,children:e.name}),a(be,{fileInfo:e,disabled:t})]}),a("div",{"data-testid":"stFileUploaderDeleteBtn",children:a(y,{onClick:()=>s(e.id),kind:w.MINIMAL,disabled:t,"aria-label":`Remove ${e.name}`,children:a(m,{content:re,size:"lg"})})})]}),Be=c.memo(Me),De=p("div",{target:"egc9vxm0"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:e.spacing.twoXS,marginBottom:e.spacing.twoXS})),Ve=p("div",{target:"egc9vxm1"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",color:e.colors.fadedText40})),Le=({currentPage:e,totalPages:s,onNext:t,onPrevious:i})=>g(De,{"data-testid":"stFileUploaderPagination",children:[a(q,{children:`Showing page ${e} of ${s}`}),g(Ve,{children:[a(y,{onClick:i,kind:w.MINIMAL,children:a(m,{content:C,size:"xl"})}),a(y,{onClick:t,kind:w.MINIMAL,children:a(m,{content:b,size:"xl"})})]})]}),Ee=c.memo(Le),z=(e,s)=>Math.ceil(e.length/s),Pe=e=>j(({pageSize:t,items:i,resetOnAdd:o,...l})=>{const[n,r]=c.useState(0),[d,u]=c.useState(()=>z(i,t)),h=ue(i);c.useEffect(()=>{h&&h.length!==i.length&&u(z(i,t)),h&&h.length<i.length?o&&r(0):n+1>=d&&r(d-1)},[i,n,t,h,o,d]);const H=()=>{r(Math.min(n+1,d-1))},k=()=>{r(Math.max(0,n-1))},$=i.slice(n*t,n*t+t);return g(_,{children:[a(e,{items:$,...l}),i.length>t?a(Ee,{pageSize:t,totalPages:d,currentPage:n+1,onNext:H,onPrevious:k}):null]})},e),Ae=({items:e,onDelete:s,disabled:t})=>a(ye,{children:e.map(i=>a(P,{children:a(Be,{fileInfo:i,onDelete:s,disabled:t})},i.id))}),Te=Pe(Ae),We=e=>a(E,{children:a(Te,{...e})}),Ne=c.memo(We);class Re extends c.PureComponent{constructor(s){super(s),this.formClearHelper=new oe,this.localFileIdCounter=1,this.forceUpdatingStatus=!1,this.componentDidUpdate=()=>{if(this.status!=="ready")return;const t=this.createWidgetValue(),{element:i,widgetMgr:o,fragmentId:l}=this.props,n=o.getFileUploaderStateValue(i);K(t,n)||o.setFileUploaderStateValue(i,t,{fromUi:!0},l)},this.isFileTypeAllowed=t=>{const{element:i}=this.props,{type:o}=i;if(!o||o.length===0)return!0;const l=t.name.toLowerCase();return o.some(n=>l.endsWith(n.toLowerCase()))},this.filterDirectoryFiles=t=>{const i=[],o=[];return t.forEach(l=>{this.isFileTypeAllowed(l)?i.push(l):o.push({file:l,errors:[{code:"file-invalid-type",message:`${l.type} files are not allowed.`}]})}),{accepted:i,rejected:o}},this.dropHandler=(t,i)=>{const{element:o}=this.props,{multipleFiles:l}=o;if(!!o.acceptDirectory&&t.length>0){const{accepted:r,rejected:d}=this.filterDirectoryFiles(t);t=r,i=[...i,...d]}if(!l&&t.length===0&&i.length>1){const r=i.findIndex(d=>d.errors.length===1&&d.errors[0].code==="too-many-files");r>=0&&(t.push(i[r].file),i.splice(r,1))}if(this.props.uploadClient.fetchFileURLs(t).then(r=>{if(!l&&t.length>0){const d=this.state.files.find(u=>u.status.type!=="error");d&&(this.forceUpdatingStatus=!0,this.deleteFile(d.id),this.forceUpdatingStatus=!1)}Y(r,t).forEach(([d,u])=>{this.uploadFile(d,u)})}).catch(r=>{this.addFiles(t.map(d=>new v(d.name,d.size,this.nextLocalFileId(),{type:"error",errorMessage:r})))}),i.length>0){const r=i.map(d=>de(d,this.nextLocalFileId(),this.maxUploadSizeInBytes));this.addFiles(r)}},this.uploadFile=(t,i)=>{const o=new AbortController,l=i.webkitRelativePath||i.name,n=new v(l,i.size,this.nextLocalFileId(),{type:"uploading",abortController:o,progress:1});this.addFile(n),this.props.uploadClient.uploadFile(this.props.element,t.uploadUrl,i,r=>this.onUploadProgress(r,n.id),o.signal).then(()=>this.onUploadComplete(n.id,t)).catch(r=>{r instanceof DOMException&&r.name==="AbortError"||this.updateFile(n.id,n.setStatus({type:"error",errorMessage:r?r.toString():"Unknown error"}))})},this.onUploadComplete=(t,i)=>{const o=this.getFile(t);f(o)||o.status.type!=="uploading"||this.updateFile(o.id,o.setStatus({type:"uploaded",fileId:i.fileId,fileUrls:i}))},this.deleteFile=t=>{if(this.props.disabled)return;const i=this.getFile(t);f(i)||(i.status.type==="uploading"&&i.status.abortController.abort(),i.status.type==="uploaded"&&i.status.fileUrls.deleteUrl&&this.props.uploadClient.deleteFile(i.status.fileUrls.deleteUrl),this.removeFile(t))},this.addFile=t=>{F.flushSync(()=>{this.setState(i=>({files:[...i.files,t]}))})},this.addFiles=t=>{F.flushSync(()=>{this.setState(i=>({files:[...i.files,...t]}))})},this.removeFile=t=>{F.flushSync(()=>{this.setState(i=>({files:i.files.filter(o=>o.id!==t)}))})},this.getFile=t=>this.state.files.find(i=>i.id===t),this.updateFile=(t,i)=>{F.flushSync(()=>{this.setState(o=>({files:o.files.map(l=>l.id===t?i:l)}))})},this.onUploadProgress=(t,i)=>{const o=this.getFile(i);if(f(o)||o.status.type!=="uploading")return;const l=Math.round(t.loaded*100/t.total);o.status.progress!==l&&this.updateFile(i,o.setStatus({type:"uploading",abortController:o.status.abortController,progress:l}))},this.onFormCleared=()=>{F.flushSync(()=>{this.setState({files:[]},()=>{const t=this.createWidgetValue();if(f(t))return;const{widgetMgr:i,element:o,fragmentId:l}=this.props;i.setFileUploaderStateValue(o,t,{fromUi:!0},l)})})},this.state=this.initialValue}get initialValue(){const s={files:[]},{widgetMgr:t,element:i}=this.props,o=t.getFileUploaderStateValue(i);if(f(o))return s;const{uploadedFileInfo:l}=o;return f(l)||l.length===0?s:{files:l.map(n=>{const r=n.name,d=n.size,u=n.fileId,h=n.fileUrls;return new v(r,d,this.nextLocalFileId(),{type:"uploaded",fileId:u,fileUrls:h})})}}componentWillUnmount(){this.formClearHelper.disconnect()}get maxUploadSizeInBytes(){const s=this.props.element.maxUploadSizeMb;return ce(s,S.Megabyte,S.Byte)}get status(){const s=t=>t.status.type==="uploading";return this.state.files.some(s)||this.forceUpdatingStatus?"updating":"ready"}componentDidMount(){const s=this.createWidgetValue(),{element:t,widgetMgr:i,fragmentId:o}=this.props;i.getFileUploaderStateValue(t)===void 0&&i.setFileUploaderStateValue(t,s,{fromUi:!1},o)}createWidgetValue(){const s=this.state.files.filter(t=>t.status.type==="uploaded").map(t=>{const{name:i,size:o,status:l}=t,{fileId:n,fileUrls:r}=l;return new J({fileId:n,fileUrls:r,name:i,size:o})});return new Q({uploadedFileInfo:s})}render(){const{files:s}=this.state,{element:t,disabled:i,widgetMgr:o,width:l}=this.props,n=t.type;this.formClearHelper.manageFormClearListener(o,t.formId,this.onFormCleared);const r=s.slice().reverse();return g(Ue,{className:"stFileUploader","data-testid":"stFileUploader",width:l,children:[a(se,{label:t.label,disabled:i,labelVisibility:Z(t.labelVisibility?.value),children:t.help&&a(ee,{children:a(te,{content:t.help,placement:ie.TOP_RIGHT})})}),a(Ce,{onDrop:this.dropHandler,multiple:t.multipleFiles,acceptedExtensions:n,maxSizeBytes:this.maxUploadSizeInBytes,label:t.label,disabled:i,acceptDirectory:!!t.acceptDirectory}),r.length>0&&a(Ne,{items:r,pageSize:3,onDelete:this.deleteFile,resetOnAdd:!0,disabled:i})]})}nextLocalFileId(){return this.localFileIdCounter++}}const je=G(c.memo(Re));export{je as default};
