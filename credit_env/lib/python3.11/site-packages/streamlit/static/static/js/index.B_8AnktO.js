import{r,E as M,_ as X,v as k,az as I,m,o as K,x as pt,u as ft,a6 as mt,a7 as bt,aA as O,e as F,j as l,l as gt,R as ht,T as yt,P as It,W as Tt,y as wt,ao as j}from"./index.CD8HuT3N.js";import{u as Ct}from"./uniqueId.Bh26R_3S.js";import{I as St}from"./InputInstructions.z6sVgyYt.js";import{u as Vt}from"./FormClearHelper.DHh1GFzm.js";import{s as vt}from"./sprintf.D7DtBTRn.js";import{I as xt}from"./input.nzVJphXi.js";import"./base-input.CK3UVGp1.js";var q=r.forwardRef(function(t,e){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(M,X({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},t,{ref:e}),r.createElement("path",{d:"M0 3v2h8V3H0z"}))});q.displayName="Minus";var J=r.forwardRef(function(t,e){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(M,X({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},t,{ref:e}),r.createElement("path",{d:"M3 0v3H0v2h3v3h2V5h3V3H5V0H3z"}))});J.displayName="Plus";const kt=k("div",{target:"eaba2yi0"})(({theme:t})=>({display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"center",height:t.sizes.minElementHeight,borderWidth:t.sizes.borderWidth,borderStyle:"solid",borderColor:t.colors.widgetBorderColor??t.colors.secondaryBg,transitionDuration:"200ms",transitionProperty:"border",transitionTimingFunction:"cubic-bezier(0.2, 0.8, 0.4, 1)",borderRadius:t.radii.default,overflow:"hidden","&.focused":{borderColor:t.colors.primary},input:{MozAppearance:"textfield","&::-webkit-inner-spin-button, &::-webkit-outer-spin-button":{WebkitAppearance:"none",margin:t.spacing.none}}})),Dt=k("div",{target:"eaba2yi1"})({display:"flex",flexDirection:"row",alignSelf:"stretch"}),_=k("button",{target:"eaba2yi2"})(({theme:t})=>({margin:t.spacing.none,border:"none",height:t.sizes.full,display:"flex",alignItems:"center",width:t.sizes.numberInputControlsWidth,justifyContent:"center",color:t.colors.bodyText,transition:"color 300ms, backgroundColor 300ms",backgroundColor:t.colors.secondaryBg,"&:hover:enabled, &:focus:enabled":{color:t.colors.white,backgroundColor:t.colors.primary,transition:"none",outline:"none"},"&:active":{outline:"none",border:"none"},"&:disabled":{cursor:"not-allowed",color:t.colors.fadedText40}})),Et=k("div",{target:"eaba2yi3"})(({theme:t,clearable:e})=>({position:"absolute",marginRight:t.spacing.twoXS,left:0,right:`calc(${t.sizes.numberInputControlsWidth} * 2 + ${e?"1em":"0em"})`})),Rt=pt.getLogger("NumberInput");function Nt(t){return m(t)||t===""?void 0:t}const zt=({value:t,format:e,step:n,dataType:b})=>{if(m(t))return null;let o=Nt(e);if(m(o)&&K(n)){const u=n.toString();b===I.DataType.FLOAT&&n!==0&&u.includes(".")&&(o=`%0.${u.split(".")[1].length}f`)}if(m(o))return t.toString();try{return vt.sprintf(o,t)}catch(u){return Rt.warn(`Error in sprintf(${o}, ${t}): ${u}`),String(t)}},Ft=(t,e,n)=>m(t)?!1:t-e>=n,Wt=(t,e,n)=>m(t)?!1:t+e<=n,Lt=t=>(t.element.dataType===I.DataType.INT?t.widgetMgr.getIntValue(t.element):t.widgetMgr.getDoubleValue(t.element))??t.element.default??null,G=({step:t,dataType:e})=>t||(e===I.DataType.INT?1:.01),Bt=({disabled:t,element:e,widgetMgr:n,fragmentId:b})=>{const o=ft(),{dataType:u,id:C,formId:f,default:W,format:L,icon:D,min:g,max:h}=e,{width:B,elementRef:Q}=mt(),[d,Y]=r.useState(()=>G(e)),Z=Lt({element:e,widgetMgr:n}),[y,T]=r.useState(!1),[s,w]=r.useState(Z),[S,P]=r.useState(!1),V=r.useRef(null),U=r.useRef(Ct("number_input_")),E=r.useMemo(()=>zt({value:s,dataType:u,format:L,step:d}),[s,u,L,d]),tt=r.useMemo(()=>S?m(s)?"":s.toString():E??"",[S,s,E]),v=Ft(s,d,g),x=Wt(s,d,h),H=bt({formId:f}),et=H?n.allowFormEnterToSubmit(f):y,ot=S&&B>o.breakpoints.hideWidgetDetails;r.useEffect(()=>{Y(G({step:e.step,dataType:e.dataType}))},[e.dataType,e.step]);const c=r.useCallback(({value:a,source:i})=>{if(K(a)&&(g>a||a>h))V.current?.reportValidity();else{const p=a??W??null;switch(u){case I.DataType.INT:n.setIntValue({id:C,formId:f},p,i,b);break;case I.DataType.FLOAT:n.setDoubleValue({id:C,formId:f},p,i,b);break;default:throw new Error("Invalid data type")}T(!1),w(p)}},[g,h,V,n,b,u,C,f,W]),rt=r.useCallback(()=>{y&&c({value:s,source:{fromUi:!0}}),P(!1)},[y,s,c]),nt=r.useCallback(()=>{P(!0)},[]),A=r.useCallback(()=>{const{value:a}=e;e.setValue=!1,w(a??null),c({value:a??null,source:{fromUi:!1}})},[e,c]);r.useEffect(()=>{e.setValue?A():c({value:s,source:{fromUi:!1}});const a=V.current;if(a){const i=p=>{p.preventDefault()};return a.addEventListener("wheel",i),()=>{a.removeEventListener("wheel",i)}}},[]),e.setValue&&A();const R=m(e.default)&&!t,at=r.useCallback(()=>{const a=e.default??null;w(a),c({value:a,source:{fromUi:!0}})},[e]);Vt({element:e,widgetMgr:n,onFormCleared:at});const st=a=>{const{value:i}=a.target;if(i==="")T(!0),w(null);else{let p;e.dataType===I.DataType.INT?p=parseInt(i,10):p=parseFloat(i),T(!0),w(p)}},N=r.useCallback(()=>{x&&(T(!0),c({value:(s??g)+d,source:{fromUi:!0}}))},[s,g,d,x]),z=r.useCallback(()=>{v&&(T(!0),c({value:(s??h)-d,source:{fromUi:!0}}))},[s,h,d,v]),it=r.useCallback(a=>{const{key:i}=a;switch(i){case"ArrowUp":a.preventDefault(),N();break;case"ArrowDown":a.preventDefault(),z();break}},[N,z]),lt=r.useCallback(a=>{a.key==="Enter"&&(y&&c({value:s,source:{fromUi:!0}}),n.allowFormEnterToSubmit(f)&&n.submitForm(f,b))},[y,s,c,n,f,b]),$=D?.startsWith(":material"),ct=$?"lg":"base",ut=O(o.iconSizes.lg)+2*O(o.spacing.twoXS),dt=D?o.breakpoints.hideNumberInputControls+ut:o.breakpoints.hideNumberInputControls;return F("div",{className:"stNumberInput","data-testid":"stNumberInput",ref:Q,children:[l(Tt,{label:e.label,disabled:t,labelVisibility:gt(e.labelVisibility?.value),htmlFor:U.current,children:e.help&&l(ht,{children:l(yt,{content:e.help,placement:It.TOP_RIGHT})})}),F(kt,{className:S?"focused":"","data-testid":"stNumberInputContainer",children:[l(xt,{type:"number",inputRef:V,value:tt,placeholder:e.placeholder,onBlur:rt,onFocus:nt,onChange:st,onKeyPress:lt,onKeyDown:it,clearable:R,clearOnEscape:R,disabled:t,"aria-label":e.label,startEnhancer:e.icon&&l(wt,{"data-testid":"stNumberInputIcon",iconValue:e.icon,size:ct}),id:U.current,overrides:{ClearIconContainer:{style:{padding:0}},ClearIcon:{props:{overrides:{Svg:{style:{color:o.colors.darkGray,padding:o.spacing.threeXS,height:o.sizes.clearIconSize,width:o.sizes.clearIconSize,":hover":{fill:o.colors.bodyText}}}}}},Input:{props:{"data-testid":"stNumberInputField",step:d,min:g,max:h,type:"number",inputMode:""},style:{fontWeight:o.fontWeights.normal,lineHeight:o.lineHeights.inputWidget,paddingRight:o.spacing.sm,paddingLeft:o.spacing.md,paddingBottom:o.spacing.sm,paddingTop:o.spacing.sm,"::placeholder":{color:o.colors.fadedText60}}},InputContainer:{style:()=>({borderTopRightRadius:0,borderBottomRightRadius:0})},Root:{style:{borderTopRightRadius:0,borderBottomRightRadius:0,borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeftWidth:0,borderRightWidth:0,borderTopWidth:0,borderBottomWidth:0,paddingRight:0,paddingLeft:D?o.spacing.sm:0}},StartEnhancer:{style:{paddingLeft:0,paddingRight:0,minWidth:o.iconSizes.lg,color:$?o.colors.fadedText60:"inherit"}}}}),B>dt&&F(Dt,{children:[l(_,{"data-testid":"stNumberInputStepDown",onClick:z,disabled:!v||t,tabIndex:-1,children:l(j,{content:q,size:"xs",color:v?"inherit":o.colors.disabled})}),l(_,{"data-testid":"stNumberInputStepUp",onClick:N,disabled:!x||t,tabIndex:-1,children:l(j,{content:J,size:"xs",color:x?"inherit":o.colors.disabled})})]})]}),ot&&l(Et,{clearable:R,children:l(St,{dirty:y,value:E??"",inForm:H,allowEnterToSubmit:et})})]})},_t=r.memo(Bt);export{_t as default};
